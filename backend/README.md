# AIFrameQuest åç«¯æœåŠ¡

## ç³»ç»Ÿæ¶æ„

æœ¬é¡¹ç›®åç«¯é‡‡ç”¨ Flask æ¡†æ¶æ„å»ºï¼Œæä¾› RESTful API æœåŠ¡ï¼Œæ”¯æŒç”¨æˆ·è®¤è¯ã€å†…å®¹ç®¡ç†ã€å›¾åƒæœç´¢ç­‰åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ” ç”¨æˆ·æ³¨å†Œä¸ç™»å½•è®¤è¯
- ğŸ“ å¤šåˆ†ç±»å†…å®¹ç®¡ç†ï¼ˆåŠ¨æ¼«ã€ç”µå½±ã€ç”µè§†å‰§ã€æ¸¸æˆç­‰ï¼‰
- ğŸ’¬ è¯„è®ºä¸è¯„åˆ†ç³»ç»Ÿ
- ğŸ” åŸºäº FAISS çš„å›¾åƒç›¸ä¼¼åº¦æœç´¢
- ğŸ–¼ï¸ é™æ€èµ„æºæœåŠ¡ï¼ˆå›¾ç‰‡æ–‡ä»¶ï¼‰
- ğŸ“Š RESTful API è®¾è®¡
- ğŸ‘¨â€ğŸ’¼ å®Œæ•´çš„ç®¡ç†å‘˜åå°
- ğŸ”¢ å¸–å­æµè§ˆæ¬¡æ•°ç»Ÿè®¡ä¸æ˜¾ç¤º
- â­ ç”¨æˆ·è¯„åˆ†ç³»ç»Ÿ
- ğŸ–¼ï¸ å¤šå›¾ç‰‡è½®æ’­å±•ç¤º
- ğŸ’¡ ç”¨æˆ·æ¨¡å—å¢å¼ºï¼šå®ç°è¯†å›¾é—®ç­”ã€æ–‡å­—æœå›¾ï¼ˆå¤šæ¨¡æ€æ£€ç´¢ï¼‰APIï¼Œä»¥åŠå›¾ç‰‡ä¸Šä¼ ç”³è¯·å¤„ç†é€»è¾‘
- ğŸ›¡ï¸ ç®¡ç†å‘˜æ¨¡å—å¢å¼ºï¼šé›†æˆAIè‡ªåŠ¨å®¡æ ¸å›¾ç‰‡ä¸è¯„è®ºåŠŸèƒ½
- ğŸš€ æ–°å¢ç›¸å…³APIæ¥å£ä»¥æ”¯æŒä¸Šè¿°é«˜çº§åŠŸèƒ½

## æŠ€æœ¯æ ˆ

- **Web æ¡†æ¶**: Flask
- **æ•°æ®åº“**: MySQL
- **ORM**: SQLAlchemy
- **å›¾åƒå¤„ç†**: PIL, FAISS, PyTorch
- **è®¤è¯**: JWT
- **å…¶ä»–**: NumPy, Pandas
- **AI/MLæ¨¡å‹**: ç”¨äºæ”¯æŒè¯†å›¾é—®ç­”ã€å¤šæ¨¡æ€æœç´¢åŠå†…å®¹å®¡æ ¸

## ç¯å¢ƒè¦æ±‚

- Python >= 3.8
- MySQL >= 5.7
- æ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ

## å®‰è£…æ­¥éª¤

### 1. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# Windows æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
venv\Scripts\activate

# Linux/Mac æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# source venv/bin/activate
```

### 2. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

## å¼€å‘ç¯å¢ƒé…ç½®

### 1. é…ç½®æ•°æ®åº“è¿æ¥

ç¼–è¾‘ `utils_database/config.py` æ–‡ä»¶ï¼Œä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼š

```python
# MySQL é…ç½®
MYSQL_CONFIG = {
    'host': 'localhost',
    'user': 'ä½ çš„ç”¨æˆ·å',            # ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„ç”¨æˆ·å
    'password': 'ä½ çš„å¯†ç ',          # ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„å¯†ç 
    'database': 'aiframequest'      # ä¿®æ”¹ä¸ºä½ åˆ›å»ºçš„åº“åç§°
}
```

### 2. é…ç½® JWT å¯†é’¥

ç¼–è¾‘ `utils/login.py` æ–‡ä»¶ï¼Œä¿®æ”¹ JWT å¯†é’¥ï¼š

```python
# JWT å¯†é’¥
JWT_SECRET = "your-secret-key"  # ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„å¯†é’¥
```

## é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app.py                 # ç”¨æˆ·åç«¯å…¥å£
â”œâ”€â”€ app-admin.py           # ç®¡ç†åå°åç«¯å…¥å£
â”œâ”€â”€ requirements.txt       # åç«¯ä¾èµ–
â”œâ”€â”€ data/                  # JSON æ•°æ®æ–‡ä»¶
â”œâ”€â”€ images/                # å›¾ç‰‡å­˜å‚¨ç›®å½•
â”œâ”€â”€ uploads/               # ä¸Šä¼ æ–‡ä»¶ä¸´æ—¶ç›®å½•
â”œâ”€â”€ utils/                 # ç”¨æˆ·ç«¯å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ faiss_search.py    # å›¾åƒæœç´¢åŠŸèƒ½
â”‚   â”œâ”€â”€ list.py            # å¸–å­ç®¡ç†åŠŸèƒ½
â”‚   â”œâ”€â”€ login.py           # ç”¨æˆ·è®¤è¯åŠŸèƒ½
â”‚   â”œâ”€â”€ views.py           # æµè§ˆæ¬¡æ•°ç»Ÿè®¡åŠŸèƒ½
â”‚   â”œâ”€â”€ text_to_image_search.py   # æ–‡å­—æœå›¾åŠŸèƒ½
â”‚   â””â”€â”€ guess_entry.py     # è¯†å›¾é—®ç­”å°æ¸¸æˆåŠŸèƒ½
â”œâ”€â”€ utils_admin/           # ç®¡ç†åå°å·¥å…·å‡½æ•°
â””â”€â”€ utils_database/        # æ•°æ®åº“ç›¸å…³å·¥å…·
    â”œâ”€â”€ config.py          # æ•°æ®åº“é…ç½®
    â”œâ”€â”€ init_db.py         # æ•°æ®åº“åˆå§‹åŒ–
    â”œâ”€â”€ import_data.py     # æ•°æ®å¯¼å…¥
    â””â”€â”€ models.py          # æ•°æ®æ¨¡å‹
```

## æ•°æ®åº“åˆå§‹åŒ–

### 1. åˆ›å»ºæ•°æ®åº“

```sql
CREATE DATABASE aiframequest CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 2. åˆ›å»ºæ•°æ®è¡¨

```bash
python -m utils_database.init_db
```

### 3. å¯¼å…¥åˆå§‹æ•°æ®

```bash
python -m utils_database.import_data
```

## å¯åŠ¨æœåŠ¡

### å¼€å‘æ¨¡å¼

```bash
# å¯åŠ¨ç”¨æˆ·åç«¯ï¼ˆç«¯å£ 5000ï¼‰
python app.py

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨ç®¡ç†åå°åç«¯ï¼ˆç«¯å£ 5001ï¼‰
python app-admin.py
```

### ç”Ÿäº§éƒ¨ç½²

#### ä½¿ç”¨ Gunicorn (Linux/Mac)

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
gunicorn -w 4 -b 0.0.0.0:5001 app-admin:app
```

#### ä½¿ç”¨ Waitress (Windows)

```bash
pip install waitress
waitress-serve --port=5000 app:app
waitress-serve --port=5001 app-admin:app
```

#### ä½¿ç”¨ Docker

```bash
# æ„å»ºé•œåƒ
docker build -t aiframequest-backend .

# è¿è¡Œå®¹å™¨
docker run -p 5000:5000 -p 5001:5001 aiframequest-backend
```

## API æ–‡æ¡£

### ç”¨æˆ·ç«¯ API

#### ç”¨æˆ·æ³¨å†Œ

```
URL: /api/register
æ–¹æ³•: POST
è®¤è¯: ä¸éœ€è¦
è¯·æ±‚ä½“:
{
    "username": "ç”¨æˆ·å",
    "password": "å¯†ç "
}
æˆåŠŸå“åº”:
{
    "message": "æ³¨å†ŒæˆåŠŸ",
    "token": "JWTä»¤ç‰Œ"
}
```

#### ç”¨æˆ·ç™»å½•

```
URL: /api/login
æ–¹æ³•: POST
è®¤è¯: ä¸éœ€è¦
è¯·æ±‚ä½“:
{
    "username": "ç”¨æˆ·å",
    "password": "å¯†ç "
}
æˆåŠŸå“åº”:
{
    "message": "ç™»å½•æˆåŠŸ",
    "token": "JWTä»¤ç‰Œ"
}
```

#### è·å–æ‰€æœ‰å¸–å­

```
URL: /api/posts
æ–¹æ³•: GET
è®¤è¯: ä¸éœ€è¦
æŸ¥è¯¢å‚æ•°:
- category: åˆ†ç±» (å¯é€‰)
- page: é¡µç  (å¯é€‰ï¼Œé»˜è®¤ä¸º1)
- per_page: æ¯é¡µæ•°é‡ (å¯é€‰ï¼Œé»˜è®¤ä¸º10)
æˆåŠŸå“åº”:
{
    "posts": [
        {
            "id": 1,
            "title": "å¸–å­æ ‡é¢˜",
            "content": "å¸–å­å†…å®¹",
            "category": "åˆ†ç±»",
            "author": "ä½œè€…",
            "created_at": "åˆ›å»ºæ—¶é—´",
            "updated_at": "æ›´æ–°æ—¶é—´",
            "views": æµè§ˆæ¬¡æ•°,
            "avg_rating": å¹³å‡è¯„åˆ†,
            "rating_count": è¯„åˆ†æ•°é‡,
            "images": ["å›¾ç‰‡1.jpg", "å›¾ç‰‡2.jpg"]
        },
        ...
    ],
    "total": æ€»æ•°é‡,
    "pages": æ€»é¡µæ•°,
    "current_page": å½“å‰é¡µç 
}
```

#### è·å–å•ä¸ªå¸–å­è¯¦æƒ…

```
URL: /api/posts/<int:post_id>
æ–¹æ³•: GET
è®¤è¯: ä¸éœ€è¦
æˆåŠŸå“åº”:
{
    "id": 1,
    "title": "å¸–å­æ ‡é¢˜",
    "content": "å¸–å­å†…å®¹",
    "category": "åˆ†ç±»",
    "author": "ä½œè€…",
    "created_at": "åˆ›å»ºæ—¶é—´",
    "updated_at": "æ›´æ–°æ—¶é—´",
    "views": æµè§ˆæ¬¡æ•°,
    "avg_rating": å¹³å‡è¯„åˆ†,
    "rating_count": è¯„åˆ†æ•°é‡,
    "images": ["å›¾ç‰‡1.jpg", "å›¾ç‰‡2.jpg"],
    "comments": [
        {
            "id": 1,
            "content": "è¯„è®ºå†…å®¹",
            "author": "è¯„è®ºä½œè€…",
            "created_at": "è¯„è®ºæ—¶é—´"
        },
        ...
    ]
}
```

#### æ›´æ–°å¸–å­æµè§ˆæ¬¡æ•°

```
URL: /api/posts/<int:post_id>/views
æ–¹æ³•: POST
è®¤è¯: ä¸éœ€è¦
è¯·æ±‚ä½“: ä¸éœ€è¦
æˆåŠŸå“åº”:
{
    "message": "æµè§ˆæ¬¡æ•°å·²æ›´æ–°",
    "views": æ›´æ–°åçš„æµè§ˆæ¬¡æ•°
}
```

#### åˆ›å»ºæ–°å¸–å­

```
URL: /api/posts
æ–¹æ³•: POST
è®¤è¯: éœ€è¦ JWT
è¯·æ±‚ä½“:
{
    "title": "å¸–å­æ ‡é¢˜",
    "content": "å¸–å­å†…å®¹",
    "category": "åˆ†ç±»"
}
æˆåŠŸå“åº”:
{
    "message": "å¸–å­åˆ›å»ºæˆåŠŸ",
    "post_id": å¸–å­ID
}
```

#### æ›´æ–°å¸–å­

```
URL: /api/posts/<int:post_id>
æ–¹æ³•: PUT
è®¤è¯: éœ€è¦ JWT
è¯·æ±‚ä½“:
{
    "title": "æ–°æ ‡é¢˜",
    "content": "æ–°å†…å®¹",
    "category": "æ–°åˆ†ç±»"
}
æˆåŠŸå“åº”:
{
    "message": "å¸–å­æ›´æ–°æˆåŠŸ"
}
```

#### åˆ é™¤å¸–å­

```
URL: /api/posts/<int:post_id>
æ–¹æ³•: DELETE
è®¤è¯: éœ€è¦ JWT
æˆåŠŸå“åº”:
{
    "message": "å¸–å­åˆ é™¤æˆåŠŸ"
}
```

#### æ·»åŠ è¯„è®º

```
URL: /api/posts/<int:post_id>/comments
æ–¹æ³•: POST
è®¤è¯: éœ€è¦ JWT
è¯·æ±‚ä½“:
{
    "content": "è¯„è®ºå†…å®¹",
    "rating": è¯„åˆ† (1-5, å¯é€‰)
}
æˆåŠŸå“åº”:
{
    "message": "è¯„è®ºæ·»åŠ æˆåŠŸ",
    "comment_id": è¯„è®ºID
}
```

#### è·å–å¸–å­çš„æ‰€æœ‰å›¾ç‰‡

```
URL: /api/posts/<int:post_id>/images
æ–¹æ³•: GET
è®¤è¯: ä¸éœ€è¦
æˆåŠŸå“åº”:
{
    "images": ["å›¾ç‰‡1.jpg", "å›¾ç‰‡2.jpg", ...]
}
```

#### è®¿é—®å›¾ç‰‡æ–‡ä»¶

```
URL: /images/<path:filename>
æ–¹æ³•: GET
è®¤è¯: ä¸éœ€è¦
æˆåŠŸå“åº”: å›¾ç‰‡æ–‡ä»¶
```

#### è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶

```
URL: /uploads/<path:filename>
æ–¹æ³•: GET
è®¤è¯: ä¸éœ€è¦
æˆåŠŸå“åº”: ä¸Šä¼ çš„æ–‡ä»¶
```

#### å›¾ç‰‡æœç´¢

```
URL: /api/search/image
æ–¹æ³•: POST
è®¤è¯: ä¸éœ€è¦
è¯·æ±‚ä½“: è¡¨å•æ•°æ®ï¼ŒåŒ…å«å›¾ç‰‡æ–‡ä»¶
æˆåŠŸå“åº”:
{
    "results": [
        {
            "post_id": å¸–å­ID,
            "title": "å¸–å­æ ‡é¢˜",
            "image": "å›¾ç‰‡æ–‡ä»¶å",
            "similarity": ç›¸ä¼¼åº¦
        },
        ...
    ]
}
```

### ç®¡ç†åå° API

#### ç®¡ç†å‘˜ç™»å½•

```
URL: /api/admin/login
æ–¹æ³•: POST
è®¤è¯: ä¸éœ€è¦
è¯·æ±‚ä½“:
{
    "username": "ç®¡ç†å‘˜ç”¨æˆ·å",
    "password": "ç®¡ç†å‘˜å¯†ç "
}
æˆåŠŸå“åº”:
{
    "message": "ç™»å½•æˆåŠŸ",
    "token": "JWTä»¤ç‰Œ"
}
```

#### è·å–æ‰€æœ‰è¯æ¡

```
URL: /api/admin/posts
æ–¹æ³•: GET
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
æŸ¥è¯¢å‚æ•°:
- category: åˆ†ç±» (å¯é€‰)
- page: é¡µç  (å¯é€‰ï¼Œé»˜è®¤ä¸º1)
- per_page: æ¯é¡µæ•°é‡ (å¯é€‰ï¼Œé»˜è®¤ä¸º10)
æˆåŠŸå“åº”:
{
    "posts": [
        {
            "id": 1,
            "title": "å¸–å­æ ‡é¢˜",
            "content": "å¸–å­å†…å®¹",
            "category": "åˆ†ç±»",
            "author": "ä½œè€…",
            "created_at": "åˆ›å»ºæ—¶é—´",
            "updated_at": "æ›´æ–°æ—¶é—´",
            "views": æµè§ˆæ¬¡æ•°,
            "avg_rating": å¹³å‡è¯„åˆ†,
            "rating_count": è¯„åˆ†æ•°é‡
        },
        ...
    ],
    "total": æ€»æ•°é‡,
    "pages": æ€»é¡µæ•°,
    "current_page": å½“å‰é¡µç 
}
```

#### æ›´æ–°è¯æ¡

```
URL: /api/admin/posts/<int:post_id>
æ–¹æ³•: PUT
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
è¯·æ±‚ä½“:
{
    "title": "æ–°æ ‡é¢˜",
    "content": "æ–°å†…å®¹",
    "category": "æ–°åˆ†ç±»",
    "author": "æ–°ä½œè€…"
}
æˆåŠŸå“åº”:
{
    "message": "è¯æ¡æ›´æ–°æˆåŠŸ"
}
```

#### åˆ›å»ºè¯æ¡

```
URL: /api/admin/posts
æ–¹æ³•: POST
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
è¯·æ±‚ä½“:
{
    "title": "å¸–å­æ ‡é¢˜",
    "content": "å¸–å­å†…å®¹",
    "category": "åˆ†ç±»",
    "author": "ä½œè€…"
}
æˆåŠŸå“åº”:
{
    "message": "è¯æ¡åˆ›å»ºæˆåŠŸ",
    "post_id": è¯æ¡ID
}
```

#### åˆ é™¤è¯æ¡

```
URL: /api/admin/posts/<int:post_id>
æ–¹æ³•: DELETE
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
æˆåŠŸå“åº”:
{
    "message": "è¯æ¡åˆ é™¤æˆåŠŸ"
}
```

#### è·å–æ‰€æœ‰å›¾ç‰‡

```
URL: /api/admin/images
æ–¹æ³•: GET
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
æŸ¥è¯¢å‚æ•°:
- page: é¡µç  (å¯é€‰ï¼Œé»˜è®¤ä¸º1)
- per_page: æ¯é¡µæ•°é‡ (å¯é€‰ï¼Œé»˜è®¤ä¸º20)
æˆåŠŸå“åº”:
{
    "images": [
        {
            "id": 1,
            "filename": "å›¾ç‰‡æ–‡ä»¶å",
            "post_id": å…³è”çš„å¸–å­ID,
            "created_at": "åˆ›å»ºæ—¶é—´"
        },
        ...
    ],
    "total": æ€»æ•°é‡,
    "pages": æ€»é¡µæ•°,
    "current_page": å½“å‰é¡µç 
}
```

#### ä¸Šä¼ å›¾ç‰‡

```
URL: /api/admin/images
æ–¹æ³•: POST
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
è¯·æ±‚ä½“: è¡¨å•æ•°æ®ï¼ŒåŒ…å«å›¾ç‰‡æ–‡ä»¶å’Œpost_id
æˆåŠŸå“åº”:
{
    "message": "å›¾ç‰‡ä¸Šä¼ æˆåŠŸ",
    "image_id": å›¾ç‰‡ID,
    "filename": "å›¾ç‰‡æ–‡ä»¶å"
}
```

#### åˆ é™¤å›¾ç‰‡

```
URL: /api/admin/images/<int:image_id>
æ–¹æ³•: DELETE
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
æˆåŠŸå“åº”:
{
    "message": "å›¾ç‰‡åˆ é™¤æˆåŠŸ"
}
```

#### è®¿é—®ç®¡ç†åå°å›¾ç‰‡

```
URL: /admin/images/<path:filename>
æ–¹æ³•: GET
è®¤è¯: ä¸éœ€è¦
æˆåŠŸå“åº”: å›¾ç‰‡æ–‡ä»¶
```

#### è·å–æ‰€æœ‰è¯„è®º

```
URL: /api/admin/comments
æ–¹æ³•: GET
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
æŸ¥è¯¢å‚æ•°:
- post_id: å¸–å­ID (å¯é€‰)
- page: é¡µç  (å¯é€‰ï¼Œé»˜è®¤ä¸º1)
- per_page: æ¯é¡µæ•°é‡ (å¯é€‰ï¼Œé»˜è®¤ä¸º20)
æˆåŠŸå“åº”:
{
    "comments": [
        {
            "id": 1,
            "content": "è¯„è®ºå†…å®¹",
            "author": "è¯„è®ºä½œè€…",
            "post_id": å…³è”çš„å¸–å­ID,
            "post_title": "å¸–å­æ ‡é¢˜",
            "created_at": "è¯„è®ºæ—¶é—´",
            "rating": è¯„åˆ†
        },
        ...
    ],
    "total": æ€»æ•°é‡,
    "pages": æ€»é¡µæ•°,
    "current_page": å½“å‰é¡µç 
}
```

#### åˆ é™¤è¯„è®º

```
URL: /api/admin/comments/<int:comment_id>
æ–¹æ³•: DELETE
è®¤è¯: éœ€è¦ç®¡ç†å‘˜ JWT
æˆåŠŸå“åº”:
{
    "message": "è¯„è®ºåˆ é™¤æˆåŠŸ"
}
```

## æµè§ˆæ¬¡æ•°ç»Ÿè®¡å®ç°

æµè§ˆæ¬¡æ•°ç»Ÿè®¡åŠŸèƒ½é€šè¿‡ä»¥ä¸‹ç»„ä»¶å®ç°ï¼š

1. æ•°æ®åº“æ¨¡å‹ï¼š`Post` æ¨¡å‹ä¸­çš„ `views` å­—æ®µå­˜å‚¨æµè§ˆæ¬¡æ•°
2. API æ¥å£ï¼š`/api/posts/<int:post_id>/views` ç”¨äºæ›´æ–°æµè§ˆæ¬¡æ•°
3. åç«¯å®ç°ï¼š`utils/views.py` ä¸­çš„ `update_post_views` å‡½æ•°å¤„ç†æµè§ˆæ¬¡æ•°æ›´æ–°é€»è¾‘
4. å‰ç«¯è°ƒç”¨ï¼šå½“ç”¨æˆ·è®¿é—®å¸–å­è¯¦æƒ…é¡µæ—¶ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨è°ƒç”¨æ›´æ–°æµè§ˆæ¬¡æ•°çš„ API

## è®¸å¯è¯

[MIT License](../LICENSE)

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚